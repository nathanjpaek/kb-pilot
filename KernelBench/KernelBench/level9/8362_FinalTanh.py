import torch


class FinalTanh(torch.nn.Module):

    def __init__(self, input_channels, hidden_channels,
        hidden_hidden_channels, num_hidden_layers):
        super(FinalTanh, self).__init__()
        self.input_channels = input_channels
        self.hidden_channels = hidden_channels
        self.hidden_hidden_channels = hidden_hidden_channels
        self.num_hidden_layers = num_hidden_layers
        self.linear_in = torch.nn.Linear(hidden_channels,
            hidden_hidden_channels)
        self.linears = torch.nn.ModuleList(torch.nn.Linear(
            hidden_hidden_channels, hidden_hidden_channels) for _ in range(
            num_hidden_layers - 1))
        self.linear_out = torch.nn.Linear(hidden_hidden_channels, 
            input_channels * hidden_channels)

    def extra_repr(self):
        return (
            'input_channels: {}, hidden_channels: {}, hidden_hidden_channels: {}, num_hidden_layers: {}'
            .format(self.input_channels, self.hidden_channels, self.
            hidden_hidden_channels, self.num_hidden_layers))

    def forward(self, z):
        z = self.linear_in(z)
        z = z.relu()
        for linear in self.linears:
            z = linear(z)
            z = z.relu()
        z = self.linear_out(z).view(*z.shape[:-1], self.hidden_channels,
            self.input_channels)
        z = z.tanh()
        return z


def get_inputs():
    return [torch.rand([4, 4, 4, 4])]


def get_init_inputs():
    return [[], {'input_channels': 4, 'hidden_channels': 4,
        'hidden_hidden_channels': 4, 'num_hidden_layers': 1}]
